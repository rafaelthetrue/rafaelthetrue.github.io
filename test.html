<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Entdecke in unserer Übersicht die nächsten Techno Raves und anstehende Events in der Nähe, egal ob Techno Raves heute, morgen oder am Wochenende im Ruhrgebiet und NRW.">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#f9f9f9">
    <title>Techno Raves 2025 (Termine, Events & Locations) - ravebro.de</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script defer data-domain="ravebro.de" src="https://plausible.io/js/script.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            background-color: #f9f9f9;
            color: #333;
            display: flex;
            flex-direction: column;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            user-select: none; /* Verhindert Textauswahl */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .header {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            color: #444;
            margin-top: 15px;
            margin-bottom: 0px;
            font-size: 24px;
        }
        h2 {
            color: #444;
            margin-top: 0px;
            margin-bottom: 0px;
            font-size: 10px;
        }
        .menu-icon-container {
            margin: 0 auto;
            text-align: right;
            position: relative;
            max-width: 800px;
        }
.menu-icon {
  font-size: 24px;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 24px;
  height: 24px;
}
.menu {
    position: absolute;
    top: 100%;
    right: 0;
    background-color: white;
    border: 1px solid #ddd;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: none;
    flex-direction: column;
    z-index: 1000;
}
.menu.show {
    display: flex;
}
        .menu a {
            padding: 10px 20px;
            text-decoration: none;
            color: #333;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        .menu a:last-child {
            border-bottom: none;
        }
        .menu a:hover {
            background-color: #f4f4f4;
        }
        .search-container {
            margin: 10px 0;
            text-align: center;
        }
        .search-container input {
            width: 80%;
            max-width: 400px;
            padding: 10px;
            font-size: 16px;
        }
        .table-container {
            overflow-y: auto;
            border: 1px solid #ddd;
            max-width: 100%;
            margin: 0 auto;
            border-collapse: collapse; /* Sorgt dafür, dass alle Zellen ohne Lücke dargestellt werden */
            padding: 0; /* Entfernt mögliche Innenabstände */
            height: 90%;
            position: relative;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* Dynamische Spaltenbreite */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 14px;
            vertical-align: top;
            word-wrap: break-word;
            white-space: normal;
        }
        th {
            background-color: #f4f4f4;
            position: sticky;
            top: 0;
            z-index: 2;
            margin: 0; /* Wichtig: Entfernt eventuell bestehende Außenabstände */
            }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr.past-event td {
            text-decoration: line-through;
            color: #888;
        }
        tr.past-event .date-cell span {
        color: #888; /* Wochentag ebenfalls ausgrauen */
        }
        .date-cell {
            text-align: center;
            white-space: nowrap; /* Verhindert Zeilenumbruch */
        }
        .date-cell span {
            font-size: 13px;
            color: #333;
            font-family: Arial, sans-serif; /* Schriftart vom Wochentag wie der Rest der Tabelle */
            display: block;
            margin-top: 0px;
        }
        /* Standardlinks in der Tabelle */
        table a:link,
        table a:visited,
        table a:hover,
        table a:active {
             color: black; /* Textfarbe immer schwarz */
        }

        /* Links in vergangenen Events */
        tr.past-event a:link,
        tr.past-event a:visited {
             color: #888; /* Ausgegraute Farbe */
        }

        tr.past-event a:hover,
        tr.past-event a:active {
        color: #666; /* Etwas dunkler beim Hover */
        text-decoration: none; /* Optional: Keine Unterstreichung */
        }
        @media (max-width: 600px) {
        body {
            font-size: 14px; /* Kleinere Schrift für mobile Endgeräte */
        }
        h1 {
            font-size: 22px; /* Kleinere Überschrift */
        }
        th, td {
            font-size: 12px; /* Kleinere Schrift in der Tabelle */
            padding: 8px; /* Weniger Padding in den Zellen */
        }
        

    /* Nur für die Spalte "Stadt" */
    td:nth-child(4) {
        word-break: break-word; /* Wörter an beliebigen Stellen brechen */
        hyphens: auto; /* Automatische Silbentrennung */
        overflow-wrap: break-word; /* Alternative für ältere Browser */
        white-space: normal; /* Erlaubt Zeilenumbruch */
        min-width: 70px; /* Mindestbreite der Spalte */
        max-width: 120px; /* Maximale Breite der Spalte, um Layout zu schützen */
    }
}
.icon-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0;
  max-width: 800px;
  margin: 10px auto;
  position: relative;
  height: 40px;
}

/* Fester Abstand in mobiler und Desktop-Ansicht */
.icon-wrapper {
  position: absolute;
  top: 0;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.icon-left {
  left: calc(50% - 90px); /* Desktop: Abstand vom mittleren Menü-Icon */
}
.icon-right {
  right: calc(50% - 90px); /* Desktop: Abstand vom mittleren Menü-Icon */
}
.icon-center {
  position: relative;
}

/* In der mobilen Ansicht verkleinern wir den Abstand */
@media (max-width: 600px) {
  .icon-left {
    left: calc(50% - 90px);
  }
  .icon-right {
    right: calc(50% - 90px);
  }
}

/* Gemeinsames Icon-Design */
.icon {
  width: 24px;
  height: 24px;
  color: #333;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Statistik-Icon (3 vertikale Balken) */
.stats-icon {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: flex-end;
  width: 24px;
  height: 24px;
  gap: 3px;
  padding-bottom: 8px;
}

.stats-icon .bar {
  width: 3px;
  background-color: #333;
  border-radius: 1px;
}

.stats-icon .bar1 { height: 6px; }
.stats-icon .bar2 { height: 12px; }
.stats-icon .bar3 { height: 9px; }

.top-icon {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 24px;
  height: 24px;
}
.trend-arrow {
  width: 24px;
  height: 24px;
  margin-top: 4px;
}

/* Popup-Styling */
#statsPopup {
  display: none;
  position: fixed;
  top: 5%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 700px;
  height: 80vh; /* Standardhöhe */
  background-color: white;
  border: 1px solid #ccc;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  z-index: 2000;
  overflow-y: auto;
  padding: 20px;
  border-radius: 8px;
}

/* Mobile Ansicht: kleinere Höhe */
@media (max-width: 600px) {
  #statsPopup {
    top: 12%;
    width: 75%;
    max-width: 340px;
    height: 65vh; /* falls du die Höhe auch reduzieren willst */
  }
}

#statsPopupClose {
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 20px;
    cursor: pointer;
    color: #666;
}

#statsPopup iframe {
    width: 100%;
    height: 100%;
    border: none;
}

    </style>
</head>
<body>
    <div class="header">
        <h1>Techno Raves 2025</h1>
        <h2>Termine, Events & Locations in NRW</h2>
    </div>
<div class="icon-bar">
  <div class="icon-wrapper icon-left">
    <div class="icon stats-icon" id="statsIcon" title="Statistik anzeigen">
      <div class="bar bar1"></div>
      <div class="bar bar2"></div>
      <div class="bar bar3"></div>
    </div>
  </div>
<div class="icon-wrapper icon-center" id="menuWrapper">
  <div class="icon menu-icon" id="menuIcon">☰</div>
  <div class="menu" id="menu">
      <a href="#" id="refreshPage">Aktualisieren</a>
      <a href="statistik.html">Statistik</a>
      <a href="datenschutzerklaerung.html">Datenschutzerklärung</a>
      <a href="impressum.html">Impressum</a>
  </div>
</div>
  <div class="icon-wrapper icon-right">
<div class="icon top-icon" id="topRavesIcon" title="Top Raves">
<svg class="trend-arrow" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" transform="translate(0, 10)">
  <polyline points="4,16 9,11 13,15 20,8" />
  <polyline points="17,8 20,8 20,11" />
</svg>
</div>
</div>
</div>
    <div class="search-container">
        <input 
            type="text" 
            id="search" 
            placeholder="Suche Datum, Event, Location oder Stadt..."
            onkeyup="searchTable()"
        >
    </div>
    <div class="table-container" id="tableContainer">
        <table id="eventTable">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Event (Link)</th>
                    <th>Location</th>
                    <th>Stadt</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
<!-- Popup HTML außerhalb von <script> -->
<div id="statsPopup">
    <div id="statsPopupClose">✕</div>
    <div id="statsPopupContent"></div>
</div>
    <script>
document.addEventListener("DOMContentLoaded", async function () {
    const tableBody = document.querySelector("#eventTable tbody");
    const now = new Date();

    // Excel-Datei laden (Pfad anpassen)
    const excelFileUrl = "events.xlsx";

    async function loadExcelFile(url) {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: "array" });
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        return XLSX.utils.sheet_to_json(worksheet);
    }

    function parseExcelDate(value) {
        if (typeof value === "number") {
            const excelEpoch = new Date(Date.UTC(1899, 11, 30));
            return new Date(excelEpoch.getTime() + value * 86400000);
        }
        return new Date(value);
    }

    function sortRows(rows) {
        return rows.sort((a, b) => {
            const dateA = new Date(a.Datum);
            const dateB = new Date(b.Datum);
            const cityA = a.Stadt?.toLowerCase() || "";
            const cityB = b.Stadt?.toLowerCase() || "";
            const eventA = a.Event?.toLowerCase() || "";
            const eventB = b.Event?.toLowerCase() || "";

            if (dateA - dateB !== 0) return dateA - dateB;
            if (cityA.localeCompare(cityB) !== 0) return cityA.localeCompare(cityB);
            return eventA.localeCompare(eventB);
        });
    }

function renderTable(rows) {
        tableBody.innerHTML = ""; // Bestehende Inhalte löschen

        rows.forEach(row => {
            if (!row.Datum || !row.Event || !row.Location || !row.Stadt) return;

            const dateObj = parseExcelDate(row.Datum);
            if (isNaN(dateObj)) return;

            const formattedDate = `${String(dateObj.getDate()).padStart(2, "0")}.${String(
                dateObj.getMonth() + 1
            ).padStart(2, "0")}`;
            const weekday = dateObj.toLocaleDateString("de-DE", { weekday: "short" }) + ".";

            const tr = document.createElement("tr");
            tr.setAttribute("data-date", dateObj.toISOString());

            const dateTd = document.createElement("td");
            dateTd.classList.add("date-cell");
            dateTd.innerHTML = `${formattedDate}<br><span>${weekday}</span>`;
            tr.appendChild(dateTd);

            const eventTd = document.createElement("td");
            eventTd.innerHTML = `<a href="${row.Link || "#"}" target="_blank">${row.Event}</a>`;
            tr.appendChild(eventTd);

            const locationTd = document.createElement("td");
            locationTd.textContent = row.Location;
            tr.appendChild(locationTd);

            const cityTd = document.createElement("td");
            cityTd.textContent = row.Stadt;
            tr.appendChild(cityTd);

            // Vergangene Events kennzeichnen
            const eventDate = new Date(dateObj);
            eventDate.setDate(eventDate.getDate() + 1);
            eventDate.setHours(6, 0, 0, 0);

            if (now > eventDate) {
                tr.classList.add("past-event");
            }

            tableBody.appendChild(tr);
        });
    }

    function scrollToNextEvent() {
        const rows = Array.from(document.querySelectorAll("#eventTable tbody tr"));
        const tableContainer = document.getElementById("tableContainer");
        const headerHeight = document.querySelector("thead").offsetHeight;

        let nextEventRow = null;

        for (const row of rows) {
            const dataDate = row.getAttribute("data-date");
            if (dataDate) {
                const eventDate = new Date(dataDate);
                eventDate.setDate(eventDate.getDate() + 1);
                eventDate.setHours(6, 0, 0, 0);

                if (now <= eventDate) {
                    nextEventRow = row;
                    break;
                }
            }
        }

        if (nextEventRow) {
            const offsetTop = nextEventRow.offsetTop;
            const scrollPosition = offsetTop - headerHeight;
            tableContainer.scrollTo({
                top: scrollPosition,
                behavior: "smooth",
            });
            console.log("Zum nächsten Event gescrollt:", nextEventRow);
        } else {
            console.log("Kein zukünftiges Event gefunden.");
        }
    }

    function generateSchemaOrgMarkup(rows) {
        const head = document.querySelector("head");

        rows.forEach(row => {
            if (!row.Datum || !row.Event || !row.Location || !row.Stadt) return;

            const dateObj = parseExcelDate(row.Datum);
            if (isNaN(dateObj)) return;

            const eventMarkup = {
                "@context": "https://schema.org",
                "@type": "Event",
                "name": row.Event,
                "startDate": dateObj.toISOString(),
                "location": {
                    "@type": "Place",
                    "name": row.Location,
                    "address": {
                        "@type": "PostalAddress",
                        "addressLocality": row.Stadt,
                        "addressCountry": "DE"
                    }
                },
                "url": row.Link || undefined
            };

            const script = document.createElement("script");
            script.type = "application/ld+json";
            script.textContent = JSON.stringify(eventMarkup, null, 2);
            head.appendChild(script);
        });
    }

    const allRows = await loadExcelFile(excelFileUrl);
const currentYear = new Date().getFullYear();

// Nur Events ab dem aktuellen Jahr (einschließlich Zukunft)
const filteredRows = allRows.filter(row => {
    const date = parseExcelDate(row.Datum);
    return !isNaN(date) && date.getFullYear() >= currentYear;
});

const sortedRows = sortRows(filteredRows);
renderTable(sortedRows);
scrollToNextEvent();
generateSchemaOrgMarkup(sortedRows);
    // Kontextmenü und Textauswahl verhindern
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());

    // Zoom deaktivieren
    document.addEventListener('gesturestart', e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('gestureend', e => e.preventDefault());

    // Menü-Toggle
    const menu = document.getElementById('menu');
    const menuIcon = document.getElementById('menuIcon');
menuIcon.addEventListener('click', () => {
    menu.classList.toggle('show');
});
document.addEventListener('click', e => {
    if (!menu.contains(e.target) && !menuIcon.contains(e.target)) {
        menu.classList.remove('show');
    }
});

    // Menü schließen, wenn ein Link angeklickt wird
    const menuLinks = document.querySelectorAll('.menu a');
menuLinks.forEach(link => {
    link.addEventListener('click', () => {
        menu.classList.remove('show');
    });
});
    // Funktion für "Aktualisieren"
        const refreshPage = document.getElementById('refreshPage');
        refreshPage.addEventListener('click', (e) => {
        e.preventDefault(); // Verhindert die Standardaktion des Links
        window.location.reload(true); // Erzwingt das Neuladen ohne Cache
        });
    // Dynamische Anpassung der Tabellenhöhe
    function adjustTableHeight() {
        const headerHeight = document.querySelector(".header").offsetHeight;
        const searchHeight = document.querySelector(".search-container").offsetHeight;
        const viewportHeight = window.innerHeight;
        const tableContainer = document.getElementById("tableContainer");
        tableContainer.style.height = `${0.90 * (viewportHeight - headerHeight - searchHeight)}px`;
    }

    // Höhe der Tabelle anpassen und bei Fenstergrößenänderungen neu berechnen
    adjustTableHeight();
    window.addEventListener('resize', adjustTableHeight);

    // Dynamische Anpassung der Viewport-Höhe (für mobile Geräte)
    function adjustViewportHeight() {
        const vh = window.innerHeight * 0.01; // 1% der tatsächlichen Fensterhöhe
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('load', adjustViewportHeight);
    window.addEventListener('resize', adjustViewportHeight);

    // Suchfunktion für die Tabelle
    function searchTable() {
        const input = document.getElementById('search');
        const filter = input.value.toLowerCase();
        const rows = document.querySelectorAll('#eventTable tbody tr');

        rows.forEach(row => {
            const cells = Array.from(row.getElementsByTagName('td'));
            const match = cells.some(cell => cell.textContent.toLowerCase().includes(filter));
            row.style.display = match ? '' : 'none';
        });
    }

    document.getElementById('search').addEventListener('keyup', searchTable);

    // Statistik-Popup öffnen/schließen
    const statsIcon = document.getElementById('statsIcon');
    const statsPopup = document.getElementById('statsPopup');
    const statsPopupClose = document.getElementById('statsPopupClose');
    // Nur die erste Tabelle aus statistik.html laden
statsIcon.addEventListener('click', async () => {
    try {
        const response = await fetch("statistik.html");
        const text = await response.text();

        // Temporäres DOM-Element zum Parsen
        const parser = new DOMParser();
        const doc = parser.parseFromString(text, "text/html");

        // Die erste Tabelle (summaryTable) extrahieren
        const summaryTable = doc.querySelector("#summaryTable");
        if (summaryTable) {
            const statsPopupContent = document.getElementById("statsPopupContent");
            statsPopupContent.innerHTML = ""; // alten Inhalt löschen
            statsPopupContent.appendChild(summaryTable.cloneNode(true));
            statsPopup.style.display = "block";
        }
    } catch (error) {
        console.error("Fehler beim Laden der Statistik:", error);
    }
});

    statsIcon.addEventListener('click', () => {
        statsPopup.style.display = 'block';
    });

    statsPopupClose.addEventListener('click', () => {
        statsPopup.style.display = 'none';
    });

// Statistik-Popup dynamisch mit berechneter Tabelle befüllen
statsIcon.addEventListener('click', async () => {
    try {
        const response = await fetch("events.xlsx");
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const data = XLSX.utils.sheet_to_json(sheet);

        const now = new Date();
        const currentYear = now.getFullYear();

        const daysUntilSunday = (7 - now.getDay()) % 7;
        const endOfWeek = new Date(now);
        endOfWeek.setDate(now.getDate() + daysUntilSunday);
        endOfWeek.setHours(23, 59, 59, 999);

        const parseExcelDate = value => {
            if (typeof value === "number") {
                const excelEpoch = new Date(Date.UTC(1899, 11, 30));
                return new Date(excelEpoch.getTime() + value * 86400000);
            }
            return new Date(value);
        };

        const thisYear = data.filter(row => {
            const date = parseExcelDate(row.Datum);
            return date.getFullYear() === currentYear;
        });

        const periodEvents = thisYear.filter(row => {
            const date = parseExcelDate(row.Datum);
            return date <= endOfWeek;
        });

        const past = periodEvents.filter(row => {
            const date = parseExcelDate(row.Datum);
            const end = new Date(date);
            end.setDate(end.getDate() + 1);
            end.setHours(6, 0, 0, 0);
            return now > end;
        });

        const future = thisYear.length - past.length;
        const startOfYear = new Date(currentYear, 0, 1);
        const daysInPeriod = Math.floor((endOfWeek - startOfYear) / (1000 * 60 * 60 * 24)) + 1;
        const avgPerDay = daysInPeriod > 0 ? periodEvents.length / daysInPeriod : 0;
        const avgPerWeek = Math.round(avgPerDay * 7);
        const avgPerMonth = Math.round(avgPerWeek * 4.345);

        const tableHTML = `
        <h2><strong>Rave-Statistik ${currentYear}</strong></h2>
        <table style="margin: 0 auto 30px auto; border-collapse: collapse; width: 100%; max-width: 400px; text-align: left;">
            <tr><th style="background-color: #f0f0f0;">Statistik</th><th style="background-color: #f0f0f0;">Raves</th></tr>
            <tr><td>Raves auf ravebro.de</td><td>${thisYear.length}</td></tr>
            <tr><td>- vergangene</td><td>${past.length}</td></tr>
            <tr><td>- bevorstehende</td><td>${future}</td></tr>
            <tr><td>Raves pro Woche</td><td>${avgPerWeek}</td></tr>
            <tr><td>Raves pro Monat</td><td>${avgPerMonth}</td></tr>
        </table>`;

        const statsPopupContent = document.getElementById("statsPopupContent");
        statsPopupContent.innerHTML = tableHTML;
        statsPopup.style.display = 'block';

    } catch (error) {
        console.error("Fehler beim Laden der Statistikdaten:", error);
    }
});

    window.addEventListener('click', (e) => {
        if (e.target === statsPopup) {
            statsPopup.style.display = 'none';
    }
});
});
</script>
</body> 
</html>
