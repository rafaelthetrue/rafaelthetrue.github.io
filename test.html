<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events aus Excel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Dein CSS bleibt unverändert */
    </style>
</head>
<body>
    <div class="header">
        <h1>Techno Raves 2025</h1>
        <h2>Termine, Events & Locations in NRW</h2>
    </div>
    <div class="table-container" id="tableContainer">
        <table id="eventTable">
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Event</th>
                    <th>Location</th>
                    <th>Stadt</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const tableBody = document.querySelector('#eventTable tbody');
            const now = new Date();
            const excelFileUrl = 'events.xlsx'; // URL der Excel-Datei

            // Excel-Datei abrufen und parsen
            async function loadExcelFile(url) {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                return XLSX.utils.sheet_to_json(worksheet);
            }

            const rows = await loadExcelFile(excelFileUrl);

            // Tabelle befüllen
            rows.forEach(row => {
                if (!row.Datum || !row.Event || !row.Location || !row.Stadt) return;

                const dateObj = new Date(row.Datum);
                const formattedDate = `${String(dateObj.getDate()).padStart(2, '0')}.${String(dateObj.getMonth() + 1).padStart(2, '0')}`;
                const weekday = dateObj.toLocaleDateString('de-DE', { weekday: 'short' }) + '.';

                const tr = document.createElement('tr');
                tr.setAttribute('data-date', row.Datum);

                // Datumsspalte
                const dateTd = document.createElement('td');
                dateTd.classList.add('date-cell');
                dateTd.innerHTML = `${formattedDate}<br><span>${weekday}</span>`;
                tr.appendChild(dateTd);

                // Event
                const eventTd = document.createElement('td');
                eventTd.innerHTML = `<a href="${row.Link || '#'}" target="_blank">${row.Event}</a>`;
                tr.appendChild(eventTd);

                // Location
                const locationTd = document.createElement('td');
                locationTd.textContent = row.Location;
                tr.appendChild(locationTd);

                // Stadt
                const cityTd = document.createElement('td');
                cityTd.textContent = row.Stadt;
                tr.appendChild(cityTd);

                // Vergangene Events markieren
                const eventDate = new Date(row.Datum);
                eventDate.setDate(eventDate.getDate() + 1);
                eventDate.setHours(6, 0, 0, 0);
                if (now > eventDate) {
                    tr.classList.add('past-event');
                }

                tableBody.appendChild(tr);
            });

            // Tabelle nach Datum sortieren
            sortTable();

            // Sortierfunktion
            function sortTable() {
                const rows = Array.from(tableBody.querySelectorAll('tr'));
                rows.sort((a, b) => {
                    const dateA = new Date(a.getAttribute('data-date'));
                    const dateB = new Date(b.getAttribute('data-date'));
                    return dateA - dateB;
                });
                rows.forEach(row => tableBody.appendChild(row));
            }
        });
    </script>
</body>
</html>
